<h1><%= @book.title %></h1>

<% if user_signed_in? %>
  <%= link_to "Edit Book", edit_book_path(@book) %>
<% end %>

<ul>
  <li>Author: <%= @book.author %></li>
  <li>Description: <%= @book.description %></li>
  <% if @book.rankings == [] %>
    <li>There is no average ranking for this book</li>
  <% else %>
    <li>Average Ranking: <%= @book.average_rank %></li>
  <% end %>
</ul>

<ul>
  <% if @rank %>
    <li><%= link_to "Edit Rank", edit_book_rank_path(@book, @rank) %></li>
    <li><%= link_to "Delete Rank", book_rank_path(@book, @rank), method: :delete %></li>
  <% else %>
  <li><%= link_to "Rank Book", new_book_rank_path(@book.id)%></li>
  <% end %>
</ul>

<h2>Book Reviews</h2>
<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
    </tr>
  <thead>

  <tbody>
    <% @book.reviews.each do |review| %>
    <tr id="<%= dom_id(review) %>">
      <td><%= review.title %></td>
      <td><%= review.description %></td>
      <td><%= link_to "Edit Review", edit_book_review_path(@book, review) %></td>
      <td>
        <% if Vote.where(review_id: review.id).first %>
          <%= link_to "Up Vote", review_vote_path(review_id: review.id, up_vote: true, down_vote: false), method: :patch %>
        <% else %>
          <%= link_to "Up Vote", review_votes_path(review_id: review.id, up_vote: true, down_vote: false), method: :post %>
        <% end %>
      </td>
      <td>
        <% if Vote.where(review_id: review.id).first %>
          <%= link_to "Down Vote", review_vote_path(review_id: review.id, up_vote: false, down_vote: true), method: :patch %>
        <% else %>
          <%= link_to "Down Vote", review_votes_path(review_id: review.id, up_vote: false, down_vote: true), method: :post %>
        <% end %>
      </td>
      <td><%= link_to "Delete Vote", review_vote_path(review_id: review.id), method: :delete %></td>
    <% end %>
    </tr>
  </tbody>
</table>

<h2>Add a Review:</h2>
<%= simple_form_for([@book, @book.reviews.build]) do |f| %>
  <div class="form-inputs">
    <%= f.input :title, required: true, autofocus: true %>
    <%= f.input :description, as: :text, required: true, autofocus: true %>
  </div>

  <div class="actions">
    <%= f.submit "Submit Review" %>
  </div>
<% end %>
